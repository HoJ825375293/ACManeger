{"ast":null,"code":"var _jsxFileName = \"/Users/jaylon_ho/Documents/GitHub/ACManeger/FrontEnd/src/components/Home.js\";\nimport React from \"react\";\nimport { Row, Col, Card, Form, Input, Button, message, Icon, Checkbox, notification } from \"antd\";\nimport { Redirect, Link } from \"react-router-dom\";\nimport store from \"../store\";\nconst FormItem = Form.Item;\n\nclass Home extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.loadAccountInfo = () => {\n      let arr,\n          reg = new RegExp(\"(^| )\" + \"accountInfo\" + \"=([^;]*)(;|$)\");\n      let accountInfo = \"\";\n      arr = document.cookie.match(reg);\n\n      if (arr) {\n        accountInfo = unescape(arr[2]);\n      } else {\n        accountInfo = null;\n      }\n\n      if (Boolean(accountInfo) === false) {\n        return false;\n      } else {\n        let userName = \"\";\n        let passWord = \"\";\n        let Remind = \"\";\n        let i = new Array();\n        i = accountInfo.split(\"&\");\n        userName = i[0];\n        passWord = i[1];\n        Remind = i[2];\n        this.setState({\n          username: userName,\n          password: passWord,\n          remind: Remind\n        });\n      }\n    };\n\n    this.saveFromPath = () => {\n      if (this.props.location.state != null) {\n        this.setState({\n          fromPath: this.props.location.state.fromPath\n        });\n      }\n    };\n\n    this.handleSubmit = e => {\n      e.preventDefault();\n      let userInfo = this.props.form.getFieldsValue();\n      this.props.form.validateFields((err, values) => {\n        if (!err) {\n          let formData = new FormData();\n          formData.append(\"telephone\", values.username);\n          formData.append(\"passCode\", values.password);\n          const init = {\n            method: \"POST\",\n            body: formData\n          };\n          fetch(\"http://localhost:8080/login\", init).then(res => res.json()).then(data => {\n            console.log(data);\n\n            if (data) {\n              if (values.remember) {\n                let accountInfo = \"\";\n                if (this.state.remind === \"\") accountInfo = values.username + \"&\" + values.password + \"&\" + \"true\";else accountInfo = values.username + \"&\" + values.password + \"&\" + this.state.remind;\n                let Days = 3;\n                let exp = new Date();\n                exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);\n                document.cookie = \"accountInfo\" + \"=\" + escape(accountInfo) + \";expires=\" + exp.toGMTString();\n              }\n\n              this.setState({\n                redirect: true\n              });\n              message.success(`${userInfo.username}, welcome`);\n            } else {\n              alert(\"Password error\");\n            }\n          });\n        }\n      });\n    };\n\n    this.state = {\n      redirect: false,\n      username: \"\",\n      password: \"\",\n      remind: \"\",\n      rememberPassword: false,\n      fromPath: \"/\"\n    };\n  }\n\n  componentWillMount() {\n    this.loadAccountInfo();\n    this.saveFromPath();\n  }\n\n  render() {\n    const action = {\n      type: \"user\",\n      user: 1,\n      UserName: this.state.username\n    };\n\n    if (this.state.redirect) {\n      notification[\"success\"]({\n        message: \"欢迎来到Travel Helper\",\n        duration: 1\n      });\n      store.dispatch(action);\n      this.setState({\n        redirect: false\n      });\n      return React.createElement(Redirect, {\n        to: this.state.fromPath,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        },\n        __self: this\n      });\n    }\n\n    const {\n      getFieldDecorator\n    } = this.props.form;\n    return (//<div  style={{backgroundImage: `url(${background})`,backgroundSize: 'cover'}}>\n      React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143\n        },\n        __self: this\n      }, React.createElement(Row, {\n        style: {\n          height: 150\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      }), React.createElement(Row, {\n        style: {\n          height: 650\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145\n        },\n        __self: this\n      }, React.createElement(Col, {\n        span: 8,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146\n        },\n        __self: this\n      }), React.createElement(Col, {\n        span: 8,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147\n        },\n        __self: this\n      }, React.createElement(Card, {\n        title: \"\\u8D26\\u6237\\u767B\\u5F55\",\n        extra: React.createElement(Link, {\n          to: {\n            pathname: this.state.fromPath\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151\n          },\n          __self: this\n        }, React.createElement(Button, {\n          type: \"link\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152\n          },\n          __self: this\n        }, \"\\u8FD4\\u56DE\")),\n        color: \"black\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148\n        },\n        __self: this\n      }, React.createElement(Form, {\n        onSubmit: this.handleSubmit,\n        className: \"login-form\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }, React.createElement(FormItem, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }, getFieldDecorator(\"username\", {\n        initialValue: this.state.username,\n        rules: [{\n          required: true,\n          message: \"用户名不能为空\"\n        }, {\n          min: 4,\n          max: 20,\n          message: \"长度最小为4,最长为20\"\n        }, {\n          pattern: new RegExp(\"^\\\\w+$\", \"g\"),\n          message: \"用户名必须为有效数字与字符或下划线\"\n        }]\n      })(React.createElement(Input, {\n        prefix: React.createElement(Icon, {\n          type: \"user\",\n          style: {\n            color: \"rgba(0,0,0,.25)\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 179\n          },\n          __self: this\n        }),\n        placeholder: \"username:13781111111\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }))), React.createElement(FormItem, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, getFieldDecorator(\"password\", {\n        initialValue: this.state.password,\n        rules: [{\n          required: true,\n          message: \"密码不能为空\"\n        }]\n      })(React.createElement(Input, {\n        prefix: React.createElement(Icon, {\n          type: \"lock\",\n          style: {\n            color: \"rgba(0,0,0,.25)\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 200\n          },\n          __self: this\n        }),\n        placeholder: \"password:bupt123456\",\n        type: \"password\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }))), React.createElement(FormItem, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, getFieldDecorator(\"remember\", {\n        valuePropName: \"checked\",\n        initialValue: true\n      })(React.createElement(Checkbox, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214\n        },\n        __self: this\n      }, \"\\u8BB0\\u4F4F\\u6211\")), React.createElement(Row, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215\n        },\n        __self: this\n      }, React.createElement(Button, {\n        type: \"primary\",\n        htmlType: \"submit\",\n        style: {\n          width: \"100%\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216\n        },\n        __self: this\n      }, \"\\u767B\\u5F55\")), React.createElement(\"a\", {\n        href: \"/\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }, \"\\u5FD8\\u8BB0\\u5BC6\\u7801\"))))), React.createElement(Col, {\n        span: 8,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      })))\n    );\n  }\n\n}\n\nexport default Home;","map":{"version":3,"sources":["/Users/jaylon_ho/Documents/GitHub/ACManeger/FrontEnd/src/components/Home.js"],"names":["React","Row","Col","Card","Form","Input","Button","message","Icon","Checkbox","notification","Redirect","Link","store","FormItem","Item","Home","Component","constructor","props","loadAccountInfo","arr","reg","RegExp","accountInfo","document","cookie","match","unescape","Boolean","userName","passWord","Remind","i","Array","split","setState","username","password","remind","saveFromPath","location","state","fromPath","handleSubmit","e","preventDefault","userInfo","form","getFieldsValue","validateFields","err","values","formData","FormData","append","init","method","body","fetch","then","res","json","data","console","log","remember","Days","exp","Date","setTime","getTime","escape","toGMTString","redirect","success","alert","rememberPassword","componentWillMount","render","action","type","user","UserName","duration","dispatch","getFieldDecorator","height","pathname","initialValue","rules","required","min","max","pattern","color","valuePropName","width"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport {\n  Row,\n  Col,\n  Card,\n  Form,\n  Input,\n  Button,\n  message,\n  Icon,\n  Checkbox,\n  notification\n} from \"antd\";\nimport { Redirect, Link } from \"react-router-dom\";\nimport store from \"../store\";\n\nconst FormItem = Form.Item;\nclass Home extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      redirect: false,\n      username: \"\",\n      password: \"\",\n      remind: \"\",\n      rememberPassword: false,\n      fromPath: \"/\"\n    };\n  }\n\n  loadAccountInfo = () => {\n    let arr,\n      reg = new RegExp(\"(^| )\" + \"accountInfo\" + \"=([^;]*)(;|$)\");\n    let accountInfo = \"\";\n    arr = document.cookie.match(reg);\n    if (arr) {\n      accountInfo = unescape(arr[2]);\n    } else {\n      accountInfo = null;\n    }\n    if (Boolean(accountInfo) === false) {\n      return false;\n    } else {\n      let userName = \"\";\n      let passWord = \"\";\n      let Remind = \"\";\n\n      let i = new Array();\n      i = accountInfo.split(\"&\");\n      userName = i[0];\n      passWord = i[1];\n      Remind = i[2];\n      this.setState({\n        username: userName,\n        password: passWord,\n        remind: Remind\n      });\n    }\n  };\n\n  saveFromPath = () => {\n    if (this.props.location.state != null) {\n      this.setState({\n        fromPath: this.props.location.state.fromPath\n      });\n    }\n  };\n\n  componentWillMount() {\n    this.loadAccountInfo();\n    this.saveFromPath();\n  }\n\n  handleSubmit = e => {\n    e.preventDefault();\n    let userInfo = this.props.form.getFieldsValue();\n    this.props.form.validateFields((err, values) => {\n      if (!err) {\n        let formData = new FormData();\n        formData.append(\"telephone\", values.username);\n        formData.append(\"passCode\", values.password);\n\n        const init = {\n          method: \"POST\",\n          body: formData\n        };\n        fetch(\"http://localhost:8080/login\", init)\n          .then(res => res.json())\n          .then(data => {\n            console.log(data);\n            if (data) {\n              if (values.remember) {\n                let accountInfo = \"\";\n                if (this.state.remind === \"\")\n                  accountInfo =\n                    values.username + \"&\" + values.password + \"&\" + \"true\";\n                else\n                  accountInfo =\n                    values.username +\n                    \"&\" +\n                    values.password +\n                    \"&\" +\n                    this.state.remind;\n                let Days = 3;\n                let exp = new Date();\n                exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);\n                document.cookie =\n                  \"accountInfo\" +\n                  \"=\" +\n                  escape(accountInfo) +\n                  \";expires=\" +\n                  exp.toGMTString();\n              }\n              this.setState({ redirect: true });\n              message.success(`${userInfo.username}, welcome`);\n            } else {\n              alert(\"Password error\");\n            }\n          });\n      }\n    });\n  };\n\n  render() {\n    const action = {\n      type: \"user\",\n      user: 1,\n      UserName: this.state.username\n    };\n    if (this.state.redirect) {\n      notification[\"success\"]({\n        message: \"欢迎来到Travel Helper\",\n        duration: 1\n      });\n      store.dispatch(action);\n      this.setState({ redirect: false });\n      return <Redirect to={this.state.fromPath} />;\n    }\n    const { getFieldDecorator } = this.props.form;\n\n    return (\n      //<div  style={{backgroundImage: `url(${background})`,backgroundSize: 'cover'}}>\n      <div>\n        <Row style={{ height: 150 }}></Row>\n        <Row style={{ height: 650 }}>\n          <Col span={8} />\n          <Col span={8}>\n            <Card\n              title=\"账户登录\"\n              extra={\n                <Link to={{ pathname: this.state.fromPath }}>\n                  <Button type=\"link\">返回</Button>\n                </Link>\n              }\n              color=\"black\"\n            >\n              <Form onSubmit={this.handleSubmit} className=\"login-form\">\n                <FormItem>\n                  {getFieldDecorator(\"username\", {\n                    initialValue: this.state.username,\n                    rules: [\n                      {\n                        required: true,\n                        message: \"用户名不能为空\"\n                      },\n                      {\n                        min: 4,\n                        max: 20,\n                        message: \"长度最小为4,最长为20\"\n                      },\n                      {\n                        pattern: new RegExp(\"^\\\\w+$\", \"g\"),\n                        message: \"用户名必须为有效数字与字符或下划线\"\n                      }\n                    ]\n                  })(\n                    <Input\n                      prefix={\n                        <Icon\n                          type=\"user\"\n                          style={{ color: \"rgba(0,0,0,.25)\" }}\n                        />\n                      }\n                      placeholder=\"username:13781111111\"\n                    ></Input>\n                  )}\n                </FormItem>\n                <FormItem>\n                  {getFieldDecorator(\"password\", {\n                    initialValue: this.state.password,\n                    rules: [\n                      {\n                        required: true,\n                        message: \"密码不能为空\"\n                      }\n                    ]\n                  })(\n                    <Input\n                      prefix={\n                        <Icon\n                          type=\"lock\"\n                          style={{ color: \"rgba(0,0,0,.25)\" }}\n                        />\n                      }\n                      placeholder=\"password:bupt123456\"\n                      type=\"password\"\n                    ></Input>\n                  )}\n                </FormItem>\n                <FormItem>\n                  {getFieldDecorator(\"remember\", {\n                    valuePropName: \"checked\",\n                    initialValue: true\n                  })(<Checkbox>记住我</Checkbox>)}\n                  <Row>\n                    <Button\n                      type=\"primary\"\n                      htmlType=\"submit\"\n                      style={{ width: \"100%\" }}\n                    >\n                      登录\n                    </Button>\n                  </Row>\n                  <a href=\"/\">忘记密码</a>\n                </FormItem>\n              </Form>\n            </Card>\n          </Col>\n          <Col span={8} />\n        </Row>\n      </div>\n    );\n  }\n}\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}